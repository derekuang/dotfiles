{{ if eq .osid "linux-fedora" -}}
#!/usr/bin/env bash

# 设置zsh为默认shell
if [ ! "$(basename -- "$SHELL")" = "zsh" ]; then
    chsh -s $(which zsh)
fi

# kanata系统服务
sudo cp {{ .chezmoi.config.sourceDir -}}/system/services/kanata.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable kanata.service

# resilio-sync系统服务
sudo usermod -aG kyd rslsync # 把rslsync添加到本地用户组使得可以访问用户目录
sudo usermod -aG rslsync kyd # 把本地用户添加到rslsync组使得可以访问同步目录
sudo chmod g+rwx {{ .chezmoi.homeDir -}}/ # 给组用户添加权限
sudo systemctl enable resilio-sync

# 设置fcitx5为默认输入法
imsettings-switch fcitx5

# 设置gtk程序配置
add_gtk_im_module() {
    local file_path="$1"

    if [[ ! -f "$file_path" ]]; then
        return 0
    fi

    if ! grep -q "^gtk-im-module" "$file_path"; then
        echo "gtk-im-module=fcitx" >> "$file_path"
    fi
}
add_gtk_im_module {{ .chezmoi.homeDir -}}/.gtkrc-2.0
add_gtk_im_module {{ .chezmoi.homeDir -}}/.config/gtk-3.0/settings.ini
add_gtk_im_module {{ .chezmoi.homeDir -}}/.config/gtk-4.0/settings.ini
add_gtk_im_module {{ .chezmoi.homeDir -}}/.config/gtk-5.0/settings.ini

# 其它：
# 手动安装NVIDIA驱动
# 重启生效关闭SELinux

{{ end -}}
